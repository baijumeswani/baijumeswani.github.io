<!-- HTML header for doxygen -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>OnnxRuntime: Training C &amp; C++ APIs</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-156955408-1"></script><script type="text/javascript">"use strict"; window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-156955408-1'); </script> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ONNX_Runtime_logo - Docs.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">OnnxRuntime
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('_ort_training_api.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Training C &amp; C++ APIs </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>In order to train a model with onnxruntime, the following training artifacts must be generated:</p><ul>
<li>The training onnx model</li>
<li>The checkpoint directory</li>
<li>The optimizer onnx model</li>
<li>The eval onnx model model (optional)</li>
</ul>
<p>These training artifacts can be generated as part of an offline step using the python <a href="https://github.com/microsoft/onnxruntime/blob/main/orttraining/orttraining/python/training/onnxblock/README.md">utilities</a> made available in the <code>onnxruntime-training</code> python package.</p>
<p>After these artifacts have been generated, the C and C++ utilities listed in this documentation can be leveraged to perform training.</p>
<p>If any problem is encountered, please create an <a href="https://github.com/microsoft/onnxruntime/issues/new">issue</a> with your scenario and requirements, and we will be sure to respond and follow up on the request.</p>
<h1>Training C API</h1>
<p><a class="el" href="struct_ort_training_api.html" title="The Training C API that holds onnxruntime training function pointers.">OrtTrainingApi</a> - Training C API functions.</p>
<p>This C structure contains functions that enable users to perform training with onnxruntime.</p>
<p><em>Sample Code</em>:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;onnxruntime_training_api.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_struct" href="struct_ort_api.html">OrtApi</a>* g_ort_api = <a class="code hl_function" href="group___global.html#gaff6ff297798b9337d4c0f89a35b76aa6">OrtGetApiBase</a>()-&gt;<a class="code hl_variable" href="struct_ort_api_base.html#ae031126e31871e4ad58ba1a647a2c9f9">GetApi</a>(<a class="code hl_define" href="group___global.html#gac583aeb4640621ceb588f6300537945d">ORT_API_VERSION</a>);</div>
<div class="line"><a class="code hl_struct" href="struct_ort_training_api.html">OrtTrainingApi</a>* g_ort_training_api = g_ort_api-&gt;<a class="code hl_variable" href="struct_ort_api.html#a165a49644eea25878451d429c4f6012f">GetTrainingApi</a>(<a class="code hl_define" href="group___global.html#gac583aeb4640621ceb588f6300537945d">ORT_API_VERSION</a>);</div>
<div class="line"> </div>
<div class="line"><a class="code hl_typedef" href="group___global.html#gaba9072a64b5081cd4d36cca5ef92bd08">OrtEnv</a>* env = NULL;</div>
<div class="line">g_ort_api-&gt;<a class="code hl_function" href="struct_ort_api.html#a22085f699a2d1adb52f809383f475ed1">CreateEnv</a>(logging_level, logid, &amp;env);</div>
<div class="line"><a class="code hl_typedef" href="group___global.html#gaa6c56bcb36e39611481a17065d3ce620">OrtSessionOptions</a>* session_options = NULL;</div>
<div class="line">g_ort_api-&gt;<a class="code hl_function" href="struct_ort_api.html#a033b8a4a9de072bcc9dda3a8434922c5">CreateSessionOptions</a>(&amp;session_options);</div>
<div class="line"> </div>
<div class="line"><a class="code hl_typedef" href="group___training_c.html#ga17e8a33114a89cfaff406982c737ec67">OrtCheckpointState</a>* state = NULL;</div>
<div class="line">g_ort_training_api-&gt;<a class="code hl_function" href="struct_ort_training_api.html#a24335192c4330ae8873e3d4566dfcb14">LoadCheckpoint</a>(path_to_checkpoint, &amp;state);</div>
<div class="line"> </div>
<div class="line"><a class="code hl_typedef" href="group___training_c.html#ga0ce08f1a044096ea60a11fe4380c5a9e">OrtTrainingSession</a>* training_session = NULL;</div>
<div class="line">g_ort_training_api-&gt;<a class="code hl_function" href="struct_ort_training_api.html#a22b4832517a0e8109ed7f243c8b9d41f">CreateTrainingSession</a>(env, session_options, training_model_path,</div>
<div class="line">                                          state, eval_model_path, optimizer_model_path,</div>
<div class="line">                                          &amp;training_session);</div>
<div class="line"><span class="comment">// Training loop</span></div>
<div class="line">{</div>
<div class="line">    g_ort_training_api-&gt;<a class="code hl_function" href="struct_ort_training_api.html#a29a0070388f7e315368df8add7f6fe68">TrainStep</a>(...);</div>
<div class="line">    g_ort_training_api-&gt;<a class="code hl_function" href="struct_ort_training_api.html#aee76c22082fad96f6d49c817a26d392d">OptimizerStep</a>(...);</div>
<div class="line">    g_ort_training_api-&gt;<a class="code hl_function" href="struct_ort_training_api.html#a19cdaccb9c13d19e79b77056c366dda2">LazyResetGrad</a>(...);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">g_ort_training_api-&gt;<a class="code hl_function" href="struct_ort_training_api.html#a314673d2f387abf638f353512b237140">ExportModelForInferencing</a>(training_session, inference_model_path, ...);</div>
<div class="line">g_ort_training_api-&gt;<a class="code hl_function" href="struct_ort_training_api.html#ac7b0da347dbbf408eaa27969a9baf120">SaveCheckpoint</a>(state, path_to_checkpoint, <span class="keyword">false</span>);</div>
<div class="ttc" id="agroup___global_html_gaa6c56bcb36e39611481a17065d3ce620"><div class="ttname"><a href="group___global.html#gaa6c56bcb36e39611481a17065d3ce620">OrtSessionOptions</a></div><div class="ttdeci">struct OrtSessionOptions OrtSessionOptions</div><div class="ttdef"><b>Definition:</b> onnxruntime_c_api.h:269</div></div>
<div class="ttc" id="agroup___global_html_gaba9072a64b5081cd4d36cca5ef92bd08"><div class="ttname"><a href="group___global.html#gaba9072a64b5081cd4d36cca5ef92bd08">OrtEnv</a></div><div class="ttdeci">struct OrtEnv OrtEnv</div><div class="ttdef"><b>Definition:</b> onnxruntime_c_api.h:257</div></div>
<div class="ttc" id="agroup___global_html_gac583aeb4640621ceb588f6300537945d"><div class="ttname"><a href="group___global.html#gac583aeb4640621ceb588f6300537945d">ORT_API_VERSION</a></div><div class="ttdeci">#define ORT_API_VERSION</div><div class="ttdoc">The API version defined in this header.</div><div class="ttdef"><b>Definition:</b> onnxruntime_c_api.h:33</div></div>
<div class="ttc" id="agroup___global_html_gaff6ff297798b9337d4c0f89a35b76aa6"><div class="ttname"><a href="group___global.html#gaff6ff297798b9337d4c0f89a35b76aa6">OrtGetApiBase</a></div><div class="ttdeci">const OrtApiBase * OrtGetApiBase(void)</div><div class="ttdoc">The Onnxruntime library's entry point to access the C API.</div></div>
<div class="ttc" id="agroup___training_c_html_ga0ce08f1a044096ea60a11fe4380c5a9e"><div class="ttname"><a href="group___training_c.html#ga0ce08f1a044096ea60a11fe4380c5a9e">OrtTrainingSession</a></div><div class="ttdeci">struct OrtTrainingSession OrtTrainingSession</div><div class="ttdef"><b>Definition:</b> onnxruntime_training_c_api.h:99</div></div>
<div class="ttc" id="agroup___training_c_html_ga17e8a33114a89cfaff406982c737ec67"><div class="ttname"><a href="group___training_c.html#ga17e8a33114a89cfaff406982c737ec67">OrtCheckpointState</a></div><div class="ttdeci">struct OrtCheckpointState OrtCheckpointState</div><div class="ttdef"><b>Definition:</b> onnxruntime_training_c_api.h:100</div></div>
<div class="ttc" id="astruct_ort_api_base_html_ae031126e31871e4ad58ba1a647a2c9f9"><div class="ttname"><a href="struct_ort_api_base.html#ae031126e31871e4ad58ba1a647a2c9f9">OrtApiBase::GetApi</a></div><div class="ttdeci">const OrtApi *(* GetApi)(uint32_t version)</div><div class="ttdoc">Get a pointer to the requested version of the OrtApi.</div><div class="ttdef"><b>Definition:</b> onnxruntime_c_api.h:621</div></div>
<div class="ttc" id="astruct_ort_api_html"><div class="ttname"><a href="struct_ort_api.html">OrtApi</a></div><div class="ttdoc">The C API.</div><div class="ttdef"><b>Definition:</b> onnxruntime_c_api.h:666</div></div>
<div class="ttc" id="astruct_ort_api_html_a033b8a4a9de072bcc9dda3a8434922c5"><div class="ttname"><a href="struct_ort_api.html#a033b8a4a9de072bcc9dda3a8434922c5">OrtApi::CreateSessionOptions</a></div><div class="ttdeci">OrtStatus * CreateSessionOptions(OrtSessionOptions **options)</div><div class="ttdoc">Create an OrtSessionOptions object.</div></div>
<div class="ttc" id="astruct_ort_api_html_a165a49644eea25878451d429c4f6012f"><div class="ttname"><a href="struct_ort_api.html#a165a49644eea25878451d429c4f6012f">OrtApi::GetTrainingApi</a></div><div class="ttdeci">const OrtTrainingApi *(* GetTrainingApi)(uint32_t version)</div><div class="ttdoc">Gets the Training C Api struct.</div><div class="ttdef"><b>Definition:</b> onnxruntime_c_api.h:3599</div></div>
<div class="ttc" id="astruct_ort_api_html_a22085f699a2d1adb52f809383f475ed1"><div class="ttname"><a href="struct_ort_api.html#a22085f699a2d1adb52f809383f475ed1">OrtApi::CreateEnv</a></div><div class="ttdeci">OrtStatus * CreateEnv(OrtLoggingLevel log_severity_level, const char *logid, OrtEnv **out)</div><div class="ttdoc">Create an OrtEnv.</div></div>
<div class="ttc" id="astruct_ort_training_api_html"><div class="ttname"><a href="struct_ort_training_api.html">OrtTrainingApi</a></div><div class="ttdoc">The Training C API that holds onnxruntime training function pointers.</div><div class="ttdef"><b>Definition:</b> onnxruntime_training_c_api.h:117</div></div>
<div class="ttc" id="astruct_ort_training_api_html_a19cdaccb9c13d19e79b77056c366dda2"><div class="ttname"><a href="struct_ort_training_api.html#a19cdaccb9c13d19e79b77056c366dda2">OrtTrainingApi::LazyResetGrad</a></div><div class="ttdeci">OrtStatus * LazyResetGrad(OrtTrainingSession *session)</div><div class="ttdoc">Reset the gradients of all trainable parameters to zero lazily.</div></div>
<div class="ttc" id="astruct_ort_training_api_html_a22b4832517a0e8109ed7f243c8b9d41f"><div class="ttname"><a href="struct_ort_training_api.html#a22b4832517a0e8109ed7f243c8b9d41f">OrtTrainingApi::CreateTrainingSession</a></div><div class="ttdeci">OrtStatus * CreateTrainingSession(const OrtEnv *env, const OrtSessionOptions *options, OrtCheckpointState *checkpoint_state, const char *train_model_path, const char *eval_model_path, const char *optimizer_model_path, OrtTrainingSession **out)</div><div class="ttdoc">Create a training session that can be used to begin or resume training.</div></div>
<div class="ttc" id="astruct_ort_training_api_html_a24335192c4330ae8873e3d4566dfcb14"><div class="ttname"><a href="struct_ort_training_api.html#a24335192c4330ae8873e3d4566dfcb14">OrtTrainingApi::LoadCheckpoint</a></div><div class="ttdeci">OrtStatus * LoadCheckpoint(const char *checkpoint_path, OrtCheckpointState **checkpoint_state)</div><div class="ttdoc">Load a checkpoint state from directory on disk into checkpoint_state.</div></div>
<div class="ttc" id="astruct_ort_training_api_html_a29a0070388f7e315368df8add7f6fe68"><div class="ttname"><a href="struct_ort_training_api.html#a29a0070388f7e315368df8add7f6fe68">OrtTrainingApi::TrainStep</a></div><div class="ttdeci">OrtStatus * TrainStep(OrtTrainingSession *sess, const OrtRunOptions *run_options, size_t inputs_len, const OrtValue *const *inputs, size_t outputs_len, OrtValue **outputs)</div><div class="ttdoc">Computes the outputs of the training model and the gradients of the trainable parameters for the give...</div></div>
<div class="ttc" id="astruct_ort_training_api_html_a314673d2f387abf638f353512b237140"><div class="ttname"><a href="struct_ort_training_api.html#a314673d2f387abf638f353512b237140">OrtTrainingApi::ExportModelForInferencing</a></div><div class="ttdeci">OrtStatus * ExportModelForInferencing(OrtTrainingSession *sess, const char *inference_model_path, size_t graph_outputs_len, const char *const *graph_output_names)</div><div class="ttdoc">Export a model that can be used for inferencing.</div></div>
<div class="ttc" id="astruct_ort_training_api_html_ac7b0da347dbbf408eaa27969a9baf120"><div class="ttname"><a href="struct_ort_training_api.html#ac7b0da347dbbf408eaa27969a9baf120">OrtTrainingApi::SaveCheckpoint</a></div><div class="ttdeci">OrtStatus * SaveCheckpoint(OrtCheckpointState *checkpoint_state, const char *checkpoint_path, const bool include_optimizer_state)</div><div class="ttdoc">Save the given state to a checkpoint directory on disk.</div></div>
<div class="ttc" id="astruct_ort_training_api_html_aee76c22082fad96f6d49c817a26d392d"><div class="ttname"><a href="struct_ort_training_api.html#aee76c22082fad96f6d49c817a26d392d">OrtTrainingApi::OptimizerStep</a></div><div class="ttdeci">OrtStatus * OptimizerStep(OrtTrainingSession *sess, const OrtRunOptions *run_options)</div><div class="ttdoc">Performs the weight updates for the trainable parameters using the optimizer model.</div></div>
</div><!-- fragment --><blockquote class="doxtable">
<p>&zwj;<b>Note</b> The <a class="el" href="group___training_c.html#ga17e8a33114a89cfaff406982c737ec67">OrtCheckpointState</a> contains the entire training state that the <a class="el" href="group___training_c.html#ga0ce08f1a044096ea60a11fe4380c5a9e">OrtTrainingSession</a> uses. As a result, the training session must always have access to the state. That is to say, the <a class="el" href="group___training_c.html#ga17e8a33114a89cfaff406982c737ec67">OrtCheckpointState</a> instance must outlive the lifetime of the <a class="el" href="group___training_c.html#ga0ce08f1a044096ea60a11fe4380c5a9e">OrtTrainingSession</a> instance. </p>
</blockquote>
<h1>Training C++ API</h1>
<p><a class="el" href="group___training_cpp.html">Ort Training C++ API</a> - Training C++ API classes and functions.</p>
<p>These C++ classes and functions enable users to perform training with onnxruntime.</p>
<p><em>Sample Code</em>:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;onnxruntime_training_cxx_api.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_struct" href="struct_ort_1_1_env.html">Ort::Env</a> env;</div>
<div class="line"><a class="code hl_struct" href="struct_ort_1_1_session_options.html">Ort::SessionOptions</a> session_options;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> state = <a class="code hl_function" href="class_ort_1_1_checkpoint_state.html#a3dff98caee7199ac96101f4de3ff8ba7">Ort::CheckpointState::LoadCheckpoint</a>(path_to_checkpoint);</div>
<div class="line"><span class="keyword">auto</span> training_session = <a class="code hl_class" href="class_ort_1_1_training_session.html">Ort::TrainingSession</a>(env, session_options, state, training_model_path,</div>
<div class="line">                                             eval_model_path, optimizer_model_path);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Training Loop</span></div>
<div class="line">{</div>
<div class="line">    training_session.TrainStep(...);</div>
<div class="line">    training_session.OptimizerStep(...);</div>
<div class="line">    training_session.LazyResetGrad(...);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">training_session-&gt;ExportModelForInferencing(inference_model_path, ...);</div>
<div class="line"><a class="code hl_function" href="class_ort_1_1_checkpoint_state.html#ae802bde116bb942a29c667b225bf2762">Ort::CheckpointState::SaveCheckpoint</a>(state, path_to_checkpoint, <span class="keyword">false</span>);</div>
<div class="ttc" id="aclass_ort_1_1_checkpoint_state_html_a3dff98caee7199ac96101f4de3ff8ba7"><div class="ttname"><a href="class_ort_1_1_checkpoint_state.html#a3dff98caee7199ac96101f4de3ff8ba7">Ort::CheckpointState::LoadCheckpoint</a></div><div class="ttdeci">static CheckpointState LoadCheckpoint(const std::basic_string&lt; char &gt; &amp;path_to_checkpoint)</div><div class="ttdoc">Load a checkpoint state from directory on disk into checkpoint_state.</div></div>
<div class="ttc" id="aclass_ort_1_1_checkpoint_state_html_ae802bde116bb942a29c667b225bf2762"><div class="ttname"><a href="class_ort_1_1_checkpoint_state.html#ae802bde116bb942a29c667b225bf2762">Ort::CheckpointState::SaveCheckpoint</a></div><div class="ttdeci">static void SaveCheckpoint(const CheckpointState &amp;checkpoint_state, const std::basic_string&lt; char &gt; &amp;path_to_checkpoint, const bool include_optimizer_state=false)</div><div class="ttdoc">Save the given state to a checkpoint directory on disk.</div></div>
<div class="ttc" id="aclass_ort_1_1_training_session_html"><div class="ttname"><a href="class_ort_1_1_training_session.html">Ort::TrainingSession</a></div><div class="ttdoc">Trainer class that provides training, evaluation and optimizer methods for training an ONNX models.</div><div class="ttdef"><b>Definition:</b> onnxruntime_training_cxx_api.h:139</div></div>
<div class="ttc" id="astruct_ort_1_1_env_html"><div class="ttname"><a href="struct_ort_1_1_env.html">Ort::Env</a></div><div class="ttdoc">The Env (Environment)</div><div class="ttdef"><b>Definition:</b> onnxruntime_cxx_api.h:404</div></div>
<div class="ttc" id="astruct_ort_1_1_session_options_html"><div class="ttname"><a href="struct_ort_1_1_session_options.html">Ort::SessionOptions</a></div><div class="ttdoc">Wrapper around OrtSessionOptions.</div><div class="ttdef"><b>Definition:</b> onnxruntime_cxx_api.h:615</div></div>
</div><!-- fragment --> <blockquote class="doxtable">
<p>&zwj;<b>Note</b> The <a class="el" href="class_ort_1_1_checkpoint_state.html" title="Holds the state of the training session.">Ort::CheckpointState</a> contains the entire training state that the <a class="el" href="class_ort_1_1_training_session.html" title="Trainer class that provides training, evaluation and optimizer methods for training an ONNX models.">Ort::TrainingSession</a> uses. As a result, the training session must always have access to the state. That is to say, the <a class="el" href="class_ort_1_1_checkpoint_state.html" title="Holds the state of the training session.">Ort::CheckpointState</a> instance must outlive the lifetime of the <a class="el" href="class_ort_1_1_training_session.html" title="Trainer class that provides training, evaluation and optimizer methods for training an ONNX models.">Ort::TrainingSession</a> instance. </p>
</blockquote>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6 </li>
  </ul>
</div>
</body>
</html>
